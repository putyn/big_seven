<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="img/favicon.ico">
	<title>Big Seven</title>
	<!-- build:css style.css -->
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/bootstrap-theme.css" rel="stylesheet">
	<link href="css/dashboard.css" rel="stylesheet">
	<link href="css/roboto.css" rel="stylesheet">
	<link href="css/nprogress.css" rel="stylesheet">
	<!-- build:css style.css -->
</head>
<body>
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Big Seven</a> </div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right visible-xs-block">
					<li><a href="#overview"> <span class="glyphicon glyphicon-dashboard"></span> Overview </a></li>
					<li><a href="#wifi"> <span class="glyphicon glyphicon-signal"></span> WiFi Setting </a></li>
					<li><a href="#time"> <span class="glyphicon glyphicon-time"></span> Time Setting </a></li>
					<li><a href="#fwupdate"> <span class="glyphicon glyphicon glyphicon-cog"></span> Firmware update </a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-3 col-md-2 sidebar">
				<ul class="nav nav-sidebar">
					<li><a href="#overview"> <span class="glyphicon glyphicon-dashboard"></span> Overview </a></li>
					<li><a href="#wifi"> <span class="glyphicon glyphicon-signal"></span> WiFi Setting </a></li>
					<li><a href="#time"> <span class="glyphicon glyphicon-time"></span> Time Setting </a></li>
					<li><a href="#fwupdate"> <span class="glyphicon glyphicon glyphicon-cog"></span> Firmware update </a></li>
				</ul>
			</div>
			<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
				<div id="container_overview">
					<h2 class="page-header">Overview</h2>
					<div class="list-group" id="overview">
						<!-- dynamically loaded -->
					</div>
				</div>
				<div id="container_wifi" class="hidden">
					<h2 class="page-header">WiFi Configuration</h2>
					<label for="network_status">Network status</label>
					<div class="list-group" id="network_status"></div>
					<label for="network_available">Available WiFi networks</label>
					<div class="list-group" id="network_available">
						<!-- dynamically loaded -->
					</div>
					<div class="form-group text-center">
						<button type="button" class="btn btn-default" id="btn_refresh" onclick="location.reload()"> <span class="glyphicon glyphicon-refresh"></span> Refresh list </button>
					</div>
					<div class="modal fade" id="network_setup" tabindex="-1" role="dialog">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
									<h4 class="modal-title" id="network_setup_title"></h4> </div>
								<div class="modal-body">
									<div id="body_pre_request">
										<label for="network_password" class="control-label">Password:</label>
										<input type="hidden" class="form-control" id="network_ssid">
										<div class="input-group">
											<input type="password" class="form-control" id="network_password"> <span class="input-group-addon glyphicon glyphicon-eye-open" id="btn_toggle_password"></span> </div>
									</div>
									<div class="hidden" id="body_post_request"></div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
									<button type="button" class="btn btn-primary" id="btn_save">Save</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="container_time" class="hidden">
					<h2 class="page-header">Time configuration</h2>
					<div class="list-group">
						<div class="list-group-item">
							<div class="row">
								<div class="col-xs-4 col-md-3 text-right"> <strong>Time Server:</strong> </div>
								<div class="col-xs-8 col-md-9 text-left">
									<input type="text" class="form-control" placeholder="ntp.pool.org" id="time_server" onclick="$(this).select()">
								</div>
							</div>
						</div>
						<div class="list-group-item">
							<div class="row">
								<div class="col-xs-4 col-md-3 text-right"> <strong>Time Zone:</strong> </div>
								<div class="col-xs-8 col-md-9 text-left">
									<select class="form-control" id="time_zone">
										<option value="-43200">UTC-12:00</option>
										<option value="-39600">UTC-11:00</option>
										<option value="-36000">UTC-10:00</option>
										<option value="-34200">UTC-09:30</option>
										<option value="-32400">UTC-09:00</option>
										<option value="-28800">UTC-08:00</option>
										<option value="-25200">UTC-07:00</option>
										<option value="-21600">UTC-06:00</option>
										<option value="-18000">UTC-05:00</option>
										<option value="-14400">UTC-04:00</option>
										<option value="-12600">UTC-03:30</option>
										<option value="-10800">UTC-03:00</option>
										<option value="-7200">UTC-02:00</option>
										<option value="-3600">UTC-01:00</option>
										<option value="0" selected="selected">UTC±00:00</option>
										<option value="+3600">UTC+01:00</option>
										<option value="+7200">UTC+02:00</option>
										<option value="+10800">UTC+03:00</option>
										<option value="+12600">UTC+03:30</option>
										<option value="+14400">UTC+04:00</option>
										<option value="+16200">UTC+04:30</option>
										<option value="+18000">UTC+05:00</option>
										<option value="+19800">UTC+05:30</option>
										<option value="+20700">UTC+05:45</option>
										<option value="+21600">UTC+06:00</option>
										<option value="+23400">UTC+06:30</option>
										<option value="+25200">UTC+07:00</option>
										<option value="+28800">UTC+08:00</option>
										<option value="+30600">UTC+08:30</option>
										<option value="+31500">UTC+08:45</option>
										<option value="+32400">UTC+09:00</option>
										<option value="+34200">UTC+09:30</option>
										<option value="+36000">UTC+10:00</option>
										<option value="+37800">UTC+10:30</option>
										<option value="+39600">UTC+11:00</option>
										<option value="+43200">UTC+12:00</option>
										<option value="+45900">UTC+12:45</option>
										<option value="+46800">UTC+13:00</option>
										<option value="+50400">UTC+14:00</option>
									</select>
								</div>
							</div>
						</div>
						<div class="list-group-item">
							<div class="row">
								<div class="col-xs-4 col-md-3 text-right"> <strong>DST:</strong> </div>
								<div class="col-xs-8 col-md-9 text-left">
									<select class="form-control" id="time_dst">
										<option value="">---</option>
										<option value="yes">Yes</option>
										<option value="no">No</option>
									</select>
								</div>
							</div>
						</div>
					</div>
					<div class="form-group text-center">
						<button type="button" class="btn btn-default" id="btn_save"> <span class="glyphicon glyphicon-ok"></span> Save </button>
					</div>
				</div>
				<div id="container_fwupdate" class="hidden">
					<h2 class="page-header">Firmware update</h2> <strong>Not yet implemented! though its desired</strong>
				</div>
			</div>
		</div>
	</div>
	<!-- build:js script.js -->
	<script src="js/jquery.js"></script>
	<script src="js/bootstrap.js"></script>
	<script src="js/nprogress.js"></script>
	<!-- endbuild -->
	<script>
		$(document).ready(function() {
			console.log("Ready to rumble");
			
			//pretty bar without  spinner
			NProgress.configure({
				showSpinner: false
			});
			
			//bind menu clicks
			$(".nav").on("click", "a", function() {
			
				var page = $(this).attr("href").replace("#", "");
				
				//remove any active menu
				$(this).parent("li").siblings().removeClass("active");
				//set current menu active
				$(this).parent("li").addClass("active");
				//hide all container
				$("div[id*=container]").addClass("hidden");
				//show container
				$("#container_" + page).removeClass("hidden");
				
				if($(".navbar-toggle").is(":visible") && $(".navbar-right").is(":visible"))
					$(".navbar-toggle").click();
				//load dynamic content	
				load_page(page);
			});
			
			//load content direct page access
			var page = window.location.hash.replace("#", "") ? window.location.hash.replace("#", "") : "overview";
			if($(".nav-sidebar").is(":visible"))
				$(".nav-sidebar > li > a[href*=" + page + "]").click();
			else
				$(".navbar-right > li > a[href*=" + page + "]").click();
		
			$("#network_available").on("click", "a", function() {
				//network ssid from custom attribute
				var network_ssid = $(this).attr("network-ssid");
				//modal title
				$("#network_setup_title").html(network_ssid);
				//hidden ssid input
				$("#network_ssid").val(network_ssid);
				//reset passd input
				$("#network_password").val("");
				//hide post request
					$("#body_post_request").hide();
				//show pre request
				$("#body_pre_request").show();
				//not sure why this is here
				$("#btn_save").html("Save").show();
				
				if($("#btn_toggle_password").hasClass("glyphicon-eye-close"))
					$("#btn_toggle_password").click();
				//show modal with keyboard for mobile devices
				$("#network_setup").modal({
					keyboard: true
				});
			}),
			
			//focus password input after modal
			$("#network_setup").on("shown.bs.modal", function() {
				$("#network_password").focus()
			});
			
			//toggle password input
			$("#btn_toggle_password").on("click", function() {
				if($(this).hasClass("glyphicon-eye-open")) {
					$(this).removeClass("glyphicon-eye-open").addClass("glyphicon-eye-close");
					$("#network_password").attr("type", "text");
					
				} else {
					$(this).removeClass("glyphicon-eye-close").addClass("glyphicon-eye-open");
					$("#network_password").attr("type", "password");
				}
			});
	});
	//dynamic load
	function load_page(page) {
	
		//load pretty bar
		NProgress.start();
		console.log("loading page - " + (page.length > 0 ? page : "overview"));
		
		switch(page){
			case "overview":
				$.getJSON("/overview", function(data) {
					var html_elements = [];
					$.each(data, function(item_name, item_value) {
							html_elements.push('<div class="list-group-item"><div class="row">');
							html_elements.push('<div class="col-xs-4 col-md-3 text-right"><strong>' + item_name + ":</strong></div>");
							html_elements.push('<div class="col-xs-8 col-md-9 text-left">' + item_value + "</div>");
							html_elements.push("</div></div>");
						}),
						$("#overview").html(html_elements.join(""))
				}).fail(function(xhr, status, error) {
					$("#container_overview").html('<h2 class="page-header">Overview</h2><div class="list-group"><div class="list-group-item list-group-item-danger">Something went wrong with the last request - <strong>' + xhr.status + " (" + error + ")</strong></div></div>")
				}).always(function() {
					NProgress.done()
				});
				break;
			case "wifi":
				$.getJSON("/wifi", function(data) {
					var html_elements = [];
					$.each(data.status, function(item_name, item_value) {
							html_elements.push('<div class="list-group-item"><div class="row">');
							html_elements.push('<div class="col-xs-4 col-md-3 text-right"><strong>' + item_name + ":</strong></div>");
							html_elements.push('<div class="col-xs-8 col-md-9 text-left">' + item_value + "</div>");
							html_elements.push("</div></div>");
						}),
						$("#network_status").html(html_elements.join(""));
					var html_elements = [];
					if( data.networks.length > 0) {
						//sort networks by quality
						data.networks = sortByKey(data.networks, "quality");
						
						$.each(data.networks, function(foo, network) {
							html_elements.push('<a class="list-group-item" network-ssid="' + network.ssid + '">' + network.ssid);
							if(network.auth)
								html_elements.push('<span class="glyphicon glyphicon-lock pull-right"></span>');
							html_elements.push("</a>");
						});
						$("#network_available").html(html_elements.join(""));
					} else {
						$("#network_available").html('<div class="list-group-item list-group-item-warning">Scan not finished or no network available</div>');
					}
				}).fail(function(xhr, status, error) {
					$("#container_wifi").html('<h2 class="page-header">WiFi Configuration</h2><div class="list-group"><div class="list-group-item list-group-item-danger">Something went wrong with the last request - <strong>' + xhr.status + " (" + error + ")</strong></div></div>")
				}).always(function() {
					NProgress.done()
				});
				break;
			case "time":
				$.getJSON("/time", function(data) {
					$("#time_server").val(data.ntp_server);
					$("#time_zone option[value='" + data.time_zone + "']").prop("selected", true);
					$("#time_dst option[value='" + data.time_dst + "']").prop("selected", true);
				}).fail(function(xhr, status, error) {
					$("#container_time").html('<h2 class="page-header">Time Configuration</h2><div class="list-group"><div class="list-group-item list-group-item-danger">Something went wrong with the last request - <strong>' + xhr.status + " (" + error + ")</strong></div></div>")
				}).always(function() {
					NProgress.done();
				});
				break;
			case "fwupdate":
				NProgress.done();
		}
	}
	//stackoverflow http://stackoverflow.com/a/8175221
	function sortByKey(e, s) {
		return e.sort(function(e, t) {
			var i = e[s],
				o = t[s];
			return i > o ? -1 : i < o ? 1 : 0
		})
	}
	</script>
</body>
</html>
